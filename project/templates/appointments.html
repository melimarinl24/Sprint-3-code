{% extends "layout.html" %}
{% block content %}
<main class="container" style="max-width:900px; margin:40px auto; padding:18px;">
  <h1>My Appointments</h1>

  <!-- Filter/search form -->
  <form method="get" action="{{ url_for('student_ui.student_appointments') }}" style="margin: 1rem 0; display: flex; gap: 0.5rem; flex-wrap: wrap;">
    <input type="search" name="q" placeholder="Search course or exam (e.g., CS202, Midterm)" value="{{ q or '' }}">
    <input type="date" name="start" value="{{ start or '' }}">
    <input type="date" name="end" value="{{ end or '' }}">
    <button type="submit">Filter</button>
    <a href="{{ url_for('student_ui.student_appointments') }}" role="button" class="secondary">Reset</a>
  </form>

  {% if bookings and bookings|length > 0 %}
    <table role="grid" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th>Code</th>
          <th>Course</th>
          <th>Exam</th>
          <th>Date</th>
          <th>Time</th>
          <th>Location</th>
          <th>Status</th>
          <th style="text-align:center;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for b in bookings %}
        <tr>
          <td><a href="{{ url_for('student_ui.confirm_page', code=b.confirmation_code) }}">{{ b.confirmation_code }}</a></td>
          <td>{{ b.course_code }}</td>
          <td>{{ b.exam_type }}</td>
          <td>{{ b.exam_date }}</td>
          <td>{{ b.exam_time or '—' }}</td>
          <td>{{ b.location or '—' }}</td>
          <td>
            {% if b.status == 'Active' %}
              <span class="contrast" style="padding:.15rem .5rem; border-radius:.5rem;">Active</span>
            {% else %}
              <span class="secondary" style="padding:.15rem .5rem; border-radius:.5rem;">Canceled</span>
            {% endif %}
          </td>
          <td style="text-align:center;">
            {% if b.status == 'Active' %}
              <!-- Cancel button -->
              <form method="POST" action="{{ url_for('student_ui.cancel_exam', exam_id=b.exam_id) }}" style="display:inline;">
                <button type="submit" class="secondary">Cancel</button>
              </form>

              <!-- Reschedule form -->
              <form method="POST" action="{{ url_for('student_ui.reschedule_exam') }}" style="display:inline;">
                <input type="hidden" name="registration_id" value="{{ b.reg_id }}">
                <input type="number" name="exam_id" placeholder="New Exam ID" style="width:80px;" required>
                <button type="submit">Reschedule</button>
              </form>
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No reservations found.</p>
  {% endif %}
</main>
{% endblock %}
